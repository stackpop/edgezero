[app]
name = "app-demo"
version = "0.1.0"
kind = "http"
entry = "crates/app-demo-core"
middleware = ["anyedge_core::middleware::RequestLogger"]

[[triggers.http]]
id = "root"
path = "/"
methods = ["GET"]
handler = "app_demo_core::handlers::root"
providers = ["fastly", "cloudflare"]

[[triggers.http]]
id = "echo"
path = "/echo/{name}"
methods = ["GET"]
handler = "app_demo_core::handlers::echo"
providers = ["fastly", "cloudflare"]

[[triggers.http]]
id = "headers"
path = "/headers"
methods = ["GET"]
handler = "app_demo_core::handlers::headers"
providers = ["fastly", "cloudflare"]

[[triggers.http]]
id = "stream"
path = "/stream"
methods = ["GET"]
handler = "app_demo_core::handlers::stream"
providers = ["fastly", "cloudflare"]
body-mode = "stream"

[[triggers.http]]
id = "echo_json"
path = "/echo"
methods = ["POST"]
handler = "app_demo_core::handlers::echo_json"
providers = ["fastly", "cloudflare"]

[[triggers.http]]
id = "routes"
path = "/__anyedge/routes"
methods = ["GET"]
handler = "app_demo_core::handlers::list_routes"
providers = ["fastly", "cloudflare"]

[environment]

[[environment.variables]]
name = "API_BASE_URL"
description = "Example upstream base (unused in demo)."
env = "API_BASE_URL"
value = "https://example.com/api"

[[environment.secrets]]
name = "API_TOKEN"
description = "Example secret placeholder."
providers = ["fastly", "cloudflare"]
env = "API_TOKEN"

[providers.fastly.adapter]
crate = "crates/app-demo-adapter-fastly"
manifest = "crates/app-demo-adapter-fastly/fastly.toml"

[providers.fastly.build]
target = "wasm32-wasip1"
profile = "release"
features = ["fastly"]

[providers.fastly.commands]
build = "cargo build --release --target wasm32-wasip1 -p app-demo-adapter-fastly"
serve = "fastly compute serve -C crates/app-demo-adapter-fastly"
deploy = "fastly compute deploy -C crates/app-demo-adapter-fastly"

[providers.cloudflare.adapter]
crate = "crates/app-demo-adapter-cloudflare"
manifest = "crates/app-demo-adapter-cloudflare/wrangler.toml"

[providers.cloudflare.build]
target = "wasm32-unknown-unknown"
profile = "release"
features = ["cloudflare"]

[providers.cloudflare.commands]
build = "cargo build --release --target wasm32-unknown-unknown -p app-demo-adapter-cloudflare"
serve = "wrangler dev --config crates/app-demo-adapter-cloudflare/wrangler.toml"
deploy = "wrangler deploy --config crates/app-demo-adapter-cloudflare/wrangler.toml"

[logging.fastly]
endpoint = "app-demo"
level = "info"
echo_stdout = true

[logging.cloudflare]
level = "info"
